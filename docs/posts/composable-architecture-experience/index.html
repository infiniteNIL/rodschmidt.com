<!DOCTYPE html>
<html lang="en-us">
    
    


    <head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
    <link href="https://gmpg.org/xfn/11" rel="profile">
    
    <link rel="canonical" href="http://localhost:1313/posts/composable-architecture-experience/">
    
    <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<!-- Enable responsiveness on mobile devices -->
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
<meta name="generator" content="Hugo 0.153.2">

    
    
    

<title>The Composable Architecture: My 3 Year Experience • Rod Schmidt</title>



  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="The Composable Architecture: My 3 Year Experience">
  <meta name="twitter:description" content="Introduction I recently finished a 3 year stint with a company that uses the Composable Architecture (TCA) from PointFree. I wanted to write about my experiences with TCA and some of the problems I see with it.
I think Brandon Williams and Stephen Cellis, the creators of TCA, are absolutely brilliant, and what they have managed to pull off with the creation of TCA is amazing. However, It’s just the two of them, and nobody, or no thing, is perfect.">
      <meta name="twitter:site" content="@rodschmidt">

<meta property="og:url" content="http://localhost:1313/posts/composable-architecture-experience/">
  <meta property="og:site_name" content="Rod Schmidt">
  <meta property="og:title" content="The Composable Architecture: My 3 Year Experience">
  <meta property="og:description" content="Introduction I recently finished a 3 year stint with a company that uses the Composable Architecture (TCA) from PointFree. I wanted to write about my experiences with TCA and some of the problems I see with it.
I think Brandon Williams and Stephen Cellis, the creators of TCA, are absolutely brilliant, and what they have managed to pull off with the creation of TCA is amazing. However, It’s just the two of them, and nobody, or no thing, is perfect.">
  <meta property="og:locale" content="en_us">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-04-26T11:35:37-06:00">
    <meta property="article:modified_time" content="2024-04-26T11:35:37-06:00">
    <meta property="article:tag" content="Architecture">
    <meta property="article:tag" content="Apple Platforms">
    <meta property="article:tag" content="TCA">
    <meta property="article:tag" content="The Composable Architecture">
    <meta property="article:tag" content="Swift">
    <meta property="article:tag" content="SwiftUI">


    






<link rel="stylesheet" href="http://localhost:1313/scss/triple-hyde.76261012483a44a81b1b96dabaf00aca4680e421c2ed623d6b52fc84f960ae3d.css" integrity="sha256-diYQEkg6RKgbG5bauvAKykaA5CHC7WI9a1L8hPlgrj0=">


<link rel="stylesheet" href="http://localhost:1313/scss/print.2744dcbf8a0b2e74f8a50e4b34e5f441be7cf93cc7de27029121c6a09f9e77bc.css" integrity="sha256-J0Tcv4oLLnT4pQ5LNOX0Qb58&#43;TzH3icCkSHGoJ&#43;ed7w=" media="print">



    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    <!-- Icons -->
    <link rel="apple-touch-icon-precomposed" sizes="144x144" href="http://localhost:1313/apple-touch-icon-144-precomposed.png">
    <link rel="shortcut icon" href="http://localhost:1313/favicon.png">
    
    

</head>


    <body class=" ">
    
<div class="sidebar">
  <div class="container ">
    <div class="sidebar-about">
  <span class="site__title">
    <a href="http://localhost:1313/">
    
      Rod Schmidt
    
    </a>
  </span>
  
  
    <div class="author-image">
      <img src="https://www.gravatar.com/avatar/e72ca1d6149c220065acbb01cd9f5d01?s=240&d=mp" class="img--circle img--headshot element--center" alt="gravatar">
    </div>
  
  <p class="site__description">
     Thoughts on Software Development 
  </p>
</div>

    <div class="collapsible-menu">
      <input type="checkbox" id="menuToggle">
      <label for="menuToggle">Rod Schmidt</label>
      <div class="menu-content">
        <div>
	<ul class="sidebar-nav">
		 
		 
			 
				<li>
					<a href="http://localhost:1313/about/">
						<span>About</span>
					</a>
				</li>
			 
		 
			 
				<li>
					<a href="http://localhost:1313/posts/">
						<span>Posts</span>
					</a>
				</li>
			 
		 
			 
				<li>
					<a href="http://localhost:1313/tags/">
						<span>Tags</span>
					</a>
				</li>
			 
		 
			 
				<li>
					<a href="http://localhost:1313/index.xml">
						<span>RSS</span>
					</a>
				</li>
			 
		
	</ul>
</div>

        <section class="social">
	
	<a href="https://twitter.com/rodschmidt" rel="me">

  <span class="relative block icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"/></svg>

  </span>

</a>
	
	
	
	<a href="https://github.com/infinitenil" rel="me">

  <span class="relative block icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><path fill="currentColor" d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>

  </span>

</a>
	
	
	
	
	
	
	
	<a href="https://linkedin.com/in/rodschmidt" rel="me">

  <span class="relative block icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentColor" d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9V416z"/></svg>

  </span>

</a>
	
	
	
	
	
	
	
	
	
	
	
	
</section>

      </div>
    </div>
    
<div class="copyright">
  &copy; 2025 Rod Schmidt
  
</div>



  </div>
</div>

        <div class="content container">
            
    
<article>
  <header>
    <h1>The Composable Architecture: My 3 Year Experience</h1>
    
    
<div class="post__meta">
    
    
      <i class="fas fa-calendar-alt"></i> Apr 26, 2024
    
    
    
    
    
      
      
          <br/>
           <i class="fas fa-tags"></i>
          
          <a class="badge badge-tag" href="http://localhost:1313/tags/architecture">architecture</a>
           
      
          <a class="badge badge-tag" href="http://localhost:1313/tags/apple-platforms">apple platforms</a>
           
      
          <a class="badge badge-tag" href="http://localhost:1313/tags/tca">tca</a>
           
      
          <a class="badge badge-tag" href="http://localhost:1313/tags/the-composable-architecture">the composable architecture</a>
           
      
          <a class="badge badge-tag" href="http://localhost:1313/tags/swift">swift</a>
           
      
          <a class="badge badge-tag" href="http://localhost:1313/tags/swiftui">swiftui</a>
          
      
    
    
    <br/>
    <i class="fas fa-clock"></i> 11 min read
</div>


  </header>
  
  
  <div class="post">
    <h2 id="introduction">Introduction</h2>
<p>I recently finished a 3 year stint with a company that uses the Composable Architecture (<a href="https://github.com/pointfreeco/swift-composable-architecture">TCA</a>)
from <a href="https://pointfree.co">PointFree</a>. I wanted to write about my experiences with TCA and some of
the problems I see with it.</p>
<p>I think Brandon Williams and Stephen Cellis, the creators of TCA, are absolutely brilliant, and what
they have managed to pull off with the creation of TCA is amazing. However, It’s just the two of them,
and nobody, or no thing, is perfect.</p>
<h2 id="the-start">The Start</h2>
<p>In February of 2021, I found out that a local company was using TCA to write their software for iOS.
I’m a big fan of functional programming, and had been watching the PointFree videos, so I was very
much interested in TCA and getting a chance to use it. I’m also a fan of the <a href="https://elm-lang.org">Elm programming language</a>,
<a href="https://guide.elm-lang.org/architecture/">The Elm Architecture</a>(TEA), and I saw TCA as a potential
version of that for iOS apps. This kind of programming is called <a href="https://en.wikipedia.org/wiki/Functional_reactive_programming">functional reactive programming</a>
and other frameworks that you may have heard of like this are <a href="https://react.dev/">React</a> and <a href="https://github.com/ReactiveX/RxSwift">RxSwift</a></p>
<p>Many iOS developers in Utah are on a Slack group where we regularly discuss things related to the industry.
I reached out to someone I knew that worked at the company and soon had an interview. I interviewed
with 3 of their lead developers. I must have done well because I started working for the company at
the beginning of March 2021. I was on a team that had responsibility for one iOS app out of 3 the
company had on the App Store. It wasn’t long before I ran into my first issue with TCA.</p>
<h2 id="its-complicated">It’s Complicated</h2>
<p>TCA has a steep learning curve. You need to learn about reducers, stores, and scoping of state and actions.
In the beginning, you had to know about view stores and environments as well (These are no longer needed,
see below). You can’t just use SwiftUI like you learned from Apple. Every view needs a store, and if
you care about performance, a view store. You need to learn how to use TCA’s top notch testing abilities,
and use a test store. You can’t just use XCTest by itself.</p>
<p>In March of 2021, TCA was at version <a href="https://github.com/pointfreeco/swift-composable-architecture/releases/tag/0.16.0">0.16.0</a>.
Things have improved a lot since then with the latest release (<a href="https://github.com/pointfreeco/swift-composable-architecture/releases/tag/1.9.0">1.9.x</a>),
but really the main things that have improved are the ergonomics of using the framework, and its performance.
View stores are no longer required with Apple&rsquo;s new <a href="https://developer.apple.com/documentation/Observation">Observation</a>
framework and <code>@Observable</code> macro introduced in iOS 17, but you need to know about TCA’s <code>@ObservableState</code>
macro. If you&rsquo;re on iOS 16 or earlier, you need to know about TCA&rsquo;s <code>withPerceptionTracking</code>, the <code>@Perceptible</code>
macro, and the <a href="https://github.com/pointfreeco/swift-perception">Perception</a> framework. Environments got
replaced with the <a href="https://github.com/pointfreeco/swift-dependencies">swift-dependencies</a> framework
and the <code>@Dependency</code> macro, and you need to learn how to use that. Macros have improved case
paths and how you refer to scoped actions.</p>
<p>Even with these improvements, you still need to learn a lot to use TCA. You also have to constantly
re-learn things as the framework gets updated and changes. All the changes have been improvements, but
it takes time to learn them, especially when you’re trying to get work done.</p>
<h2 id="the-churn">The Churn</h2>
<p>TCA changes a lot, significantly. More than the iOS SDK. When I say significantly, I mean that, while
backward compatibility was kept, the new functionality had significant changes that you wanted to use
and would improve the code, but would require significant changes to use.</p>
<p>Over my 3 years, it went from version 0.16.0 to 1.9.2. There were 95 releases over the 3 years, most
of them minor (<a href="https://semver.org/">semver</a> wise) releases that just added functionality and kept
backward compatibility. Now, we were using a pre-1.0 framework, so you can’t really blame TCA or PointFree,
but if you look at just the releases between 1.0 (July 2023) and 1.9.2 (March 2024), there were 24 releases
in less than a year. Again, most of them minor releases, but with significant additions.</p>
<p>When I left, we were still using 1.6, because when we attempted to migrate to 1.7 with the new Observation
support, we ran into some issues that would require lots of changes and some other tricky issues to
resolve because we were still supporting iOS 15. This meant we couldn’t use Apple’s Observation framework.
Instead, we needed to use PointFree&rsquo;s Perception framework and wrap many views in <code>withPerceptionTracking</code>.
This in itself is tricky, as you need to start at the root view and work down the view tree. If you
don’t, you’ll end up with run-time warnings and lots of run-time issues. Using the <code>@ObservableState</code>
macro presented another problem, because macros don’t play well with property wrappers, which we were
using in our state. (See Performance Issues).</p>
<p>More on our team structure later, but when you have 8 teams, all with their own code that needs to be
updated at the same time as all the other teams, migrating to a new version is not always easy, especially
if teams are under pressure to deliver features.</p>
<h2 id="architectural-issues">Architectural Issues</h2>
<p>I’ve already talked about how complicated TCA is. You can be much more productive with another architecture,
such as MVVM (with additional pieces), and get the same benefits, such as a unidirectional data flow,
easier unit testing, and modular code. See some of my other posts on this, but I intend to delve deeper
into this in future posts.</p>
<p>The other issue is that TCA is built around functional programming and this is in opposition to the iOS
SDK’s object-oriented roots. Yes, Swift and SwiftUI are more functional, but they are built on top of
Objective-C and Cocoa, an object-oriented language and framework. Everything is designed and optimized
around that. TCA is functional and can’t take advantage of that, resulting in performance issues, and
an impedance mismatch with the platform.</p>
<p>Take reducers and actions for example. To me, this is just object-oriented message passing. TCA basically
implements its own message passing and handling. When using TCA, I just wanted to call a method, which
would be the equivalent of sending the action. With MVVM, or another architecture, I would be able to
do just this.</p>
<p>There’s basically no encapsulation. Code can intercept an action sent from anywhere in the reducer hierarchy,
and all the state for a reducer hierarchy has to exist in the root state. You can’t hide a piece of state
from other areas, nor can you hide actions.</p>
<p>Another issue is massive reducers. Just like MVC can lead to Massive View Controllers, I’ve seen TCA
lead to Massive Reducers. Our application reducer was so large, Xcode had problems scrolling through
it, and it wouldn’t give you valid compiler errors. I ended up splitting it up into about 20 separate
files containing extensions to the app reducer. Each extension was for handling a related group of actions.
So, the app reducer was handling at least 20 different responsibilities.</p>
<p>Reducers are mostly just a switch statement with a case for each action. People tend to just put all
the action handling in there without calling out to separate functions on the reducer. Composing reducers
can be a pain (see It’s Complicated), so your usually under pressure developer just throws everything
into that switch statement.</p>
<p>One could argue that this is a skill issue (or laziness), and I would be inclined to agree with you.
We also all know how common an issue like Massive View Controllers is.</p>
<h2 id="performance-issues">Performance Issues</h2>
<p>With our large application, we ran into some performance issues.</p>
<p>First, TCA uses a lot of stack. If you try to debug a TCA application, good luck trying to find where
your code is being called from. The stack is so large and there’s so many TCA framework functions calls
to handle actions. With our large application and large application state, we&rsquo;d have stack overflow
errors, and would have to increase the stack space allocated to our code. We also resorted to creating
a property wrapper to put references in our application state, which is usually just a struct with value
types.</p>
<p>Next, as mentioned above, processing an action can be quite slow. Each action has to go up through the
entire reducer tree. In a large application, that can be significant. Similar to how Objective-C message
sending could be slow.</p>
<p>Also, because of the lack of encapsulation (i.e. free access to state and actions), and the composition
of reducers, changing some code in one area, would frequently require lots of code to be recompiled,
resulting in slow build times.</p>
<h2 id="company-organizational-issues">Company Organizational Issues</h2>
<p>When I started with the company, I was on a team that had complete control of one app. That app was discontinued,
and when I left, I was on a platform team, supporting 7 other teams, all working on one app. This made
things even more complicated. All 8 teams had to use the same version of TCA, so when we wanted to upgrade,
everyone had to upgrade, due to the Swift Package Manager not allowing multiple version of the same
framework.</p>
<p>Since TCA has no encapsulation, and any parent reducer can get access to any child’s state or actions,
you run into problems with teams reaching into other stores and relying on code they shouldn’t be. Even
if your teams are disciplined, this can just happen because a parent’s state contains all the children
states. That code may change and then the calling code breaks. This happened frequently and we basically
had to build the entire app during our PR checks to make sure nothing got broken.</p>
<p>With this many teams, you need to put some measures in place to deal with these issues. One solution is
to have separate stores for each team. That way each team’s code would be isolated and executing in
their own store. The brilliant <a href="https://www.merowing.info/">Krzysztof Zabłocki</a> has written about this
and I recommend his site for other ways to deal with TCA’s scaling issues, such as partitioning your
actions into delegate and internal actions. If you use separate stores, you will then need to figure
out how to communicate between stores. One approach would be to have each team (or store) have a TCA
client (i.e. a dependency) that another team could use. This client would, in effect, create a clean
boundary or interface between two teams.</p>
<h2 id="company-risks">Company Risks</h2>
<p>Let’s talk about the risks a company takes on when choosing a framework like TCA.</p>
<p>First off, TCA is a 3rd party framework. This means Apple doesn’t support it or care about it. Something
Apple does may break it (like a new iOS release) and you may have to wait for the framework to get updated.
The framework can’t take full advantage of the platform like Apple can, because it can’t make use of
internals like Apple can. This is really an issue with TCA because of the performance issues I talked
about.</p>
<p>Next, TCA is primarily the work of 2 guys. 2 brilliant and prolific guys, but 2 guys nonetheless. If
they get bored, injured, change careers, whatever, you could be in some trouble. This is mitigated somewhat
by TCA being open-source and presumably a company and/or the community could take over, but it is still
an issue.</p>
<p>Lastly, a company as large as the one I worked for, really shouldn’t be using an immature framework like
TCA was. I think, now at 1.9.x, TCA is pretty mature. You don’t want to start at 0.16.0. This is what
happens when you have inexperienced developers (most software developers have &lt; 5 years experience,
according to Uncle Bob) wanting to use some cool tech, and managers listening to them, who really should
know better. Some of these managers, even had technical experience.</p>
<p>I asked why TCA was chosen and was told they chose it because they needed an architecture to keep all
the developers from doing whatever they wanted. Their main concern was all the contractors they have
in Eastern Europe. This doesn’t seem like a very good reason to choose a framework to me. There are
other architectures to use, such as MVVM (or MVVM+), that are easier to use and serve the same purpose.
If that is your concern, maybe you should just hire better developers and provide better guidance?
In all fairness, the developers we had in Eastern Europe were pretty good and they didn’t need an architecture
like TCA to keep them in line.</p>
<h2 id="conclusion">Conclusion</h2>
<p>TCA is an incredible accomplishment, but it has some problems when used in a large application composed
of code from multiple teams. Your mileage may vary and it could work for you, especially if you have a
single team, a relatively small application, or some great disciplined developers. With a large app and
multiple teams you will need to deal with the lack of encapsulation and other scaling issues.</p>
<p>TCA is a 3rd party framework without Apple’s support, and it depends on just 2 brilliant guys that you’re
basically betting your whole code base on. It’s a functional programming based framework that goes against
SwiftUI’s object-oriented heritage and influence. You might be more productive onboarding new developers
and adding features with another architecture and still be able to achieve your desired architectural
discipline with MVVM or Clean Architecture.</p>
<p>In future posts, I will talk about how you can use a simpler architecture to achieve the same goals as
you would want to achieve with TCA, and how to establish clean boundaries between different areas of
your code or between teams. Some of my previous posts have already talked about this, but new posts would
be more specific to SwiftUI, and address clean boundaries.</p>
<p>I’m available for consulting, so if you need help addressing these issues, I can provide suggestions
and guidance.</p>

  </div>
  

<div class="navigation navigation-single">
    
    <a href="http://localhost:1313/posts/baseball-stl/" class="navigation-prev">
      <i aria-hidden="true" class="fa fa-chevron-left"></i>
      <span class="navigation-tittle">St. Louis Cardinals, My Penultimate Baseball Stadium?</span>
    </a>
    
    
    <a href="http://localhost:1313/posts/syncups/" class="navigation-next">
      <span class="navigation-tittle">Pointfree&#39;s SyncUps App: A Great Example Architecture for a SwiftUI App</span>
      <i aria-hidden="true" class="fa fa-chevron-right"></i>
    </a>
    
</div>


  

  
    


</article>


        </div>
        
    




    



    </body>
</html>
