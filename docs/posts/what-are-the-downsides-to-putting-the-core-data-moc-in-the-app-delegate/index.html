<!doctype html><html lang=en-us><head><link href=https://gmpg.org/xfn/11 rel=profile><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta http-equiv=cache-control content="public"><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1"><meta name=generator content="Hugo 0.119.0"><title>What are the Downsides to Putting the Core Data MOC in the App Delegate? • Rod Schmidt</title><meta name=twitter:card content="summary"><meta name=twitter:title content="What are the Downsides to Putting the Core Data MOC in the App Delegate?"><meta name=twitter:description content="I saw this question on the iOSProgramming topic in reddit:
I&rsquo;ve seen a number of different ways to access the NSManagedObjectContext when working with Core Data, but I was wondering if there are any downsides to the way I&rsquo;ve been doing it. Basically, I stick a computed variable in the AppDelegate, and grab it when I need it&mldr; Please let me know if you see any flaws&mldr; If not, feel free to use it!"><meta property="og:title" content="What are the Downsides to Putting the Core Data MOC in the App Delegate?"><meta property="og:description" content="I saw this question on the iOSProgramming topic in reddit:
I&rsquo;ve seen a number of different ways to access the NSManagedObjectContext when working with Core Data, but I was wondering if there are any downsides to the way I&rsquo;ve been doing it. Basically, I stick a computed variable in the AppDelegate, and grab it when I need it&mldr; Please let me know if you see any flaws&mldr; If not, feel free to use it!"><meta property="og:type" content="article"><meta property="og:url" content="https://rodschmidt.com/posts/what-are-the-downsides-to-putting-the-core-data-moc-in-the-app-delegate/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2016-08-25T20:59:37+00:00"><meta property="article:modified_time" content="2016-08-25T20:59:37+00:00"><link rel=stylesheet href=https://rodschmidt.com/scss/hyde-hyde.0d89d10ddd2f2e23f97e661848b7ad8092fbfcbe8d60e4d1564914cf25d188d8.css integrity="sha256-DYnRDd0vLiP5fmYYSLetgJL7/L6NYOTRVkkUzyXRiNg="><link rel=stylesheet href=https://rodschmidt.com/scss/print.2744dcbf8a0b2e74f8a50e4b34e5f441be7cf93cc7de27029121c6a09f9e77bc.css integrity="sha256-J0Tcv4oLLnT4pQ5LNOX0Qb58+TzH3icCkSHGoJ+ed7w=" media=print><!--[if lt IE 9]><script src=https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js></script>
<script src=https://oss.maxcdn.com/respond/1.4.2/respond.min.js></script><![endif]--><link rel=apple-touch-icon-precomposed sizes=144x144 href=https://rodschmidt.com/apple-touch-icon-144-precomposed.png><link rel="shortcut icon" href=https://rodschmidt.com/favicon.png></head><body><div class=sidebar><div class=container><div class=sidebar-about><span class=site__title><a href=https://rodschmidt.com/>Rod Schmidt</a></span><div class=author-image><img src="https://www.gravatar.com/avatar/e72ca1d6149c220065acbb01cd9f5d01?s=240&d=mp" class="img--circle img--headshot element--center" alt=gravatar></div><p class=site__description>Thoughts on Software Development</p></div><div class=collapsible-menu><input type=checkbox id=menuToggle>
<label for=menuToggle>Rod Schmidt</label><div class=menu-content><div><ul class=sidebar-nav><li><a href=https://rodschmidt.com/about/><span>About</span></a></li><li><a href=https://rodschmidt.com/posts/><span>Posts</span></a></li><li><a href=https://rodschmidt.com/tags/><span>Tags</span></a></li><li><a href=https://rodschmidt.com/index.xml><span>RSS</span></a></li></ul></div><section class=social><a href=https://twitter.com/rodschmidt rel=me><i class="fab fa-twitter fa-lg" aria-hidden=true></i></a>
<a href=https://github.com/infinitenil rel=me><i class="fab fa-github fa-lg" aria-hidden=true></i></a>
<a href=https://linkedin.com/in/rodschmidt rel=me><i class="fab fa-linkedin fa-lg" aria-hidden=true></i></a>
<a href=https://stackoverflow.com/users/117435 rel=me><i class="fab fa-stack-overflow fa-lg" aria-hidden=true></i></a></section></div></div><div class=copyright>&copy; 2025 Rod Schmidt</div></div></div><div class="content container"><article><header><h1>What are the Downsides to Putting the Core Data MOC in the App Delegate?</h1><div class=post__meta><i class="fas fa-calendar-alt"></i> Aug 25, 2016<br><i class="fas fa-tags"></i>
<a class="badge badge-tag" href=https://rodschmidt.com/tags/apple-platforms>apple platforms</a>
<a class="badge badge-tag" href=https://rodschmidt.com/tags/software-development>software development</a><br></div></header><div class=post><p>I saw this question on the <a href=https://www.reddit.com/r/iOSProgramming>iOSProgramming</a> topic in reddit:</p><blockquote><p>I&rsquo;ve seen a number of different ways to access the NSManagedObjectContext when working with Core Data, but I was wondering if there are any downsides to the way I&rsquo;ve been doing it. Basically, I stick a computed variable in the AppDelegate, and grab it when I need it&mldr; Please let me know if you see any flaws&mldr; If not, feel free to use it!</p></blockquote><p>The writer then shows the following code which is the computed variable:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-swift data-lang=swift><span style=display:flex><span><span style=color:#66d9ef>static</span> <span style=color:#66d9ef>var</span> myManagedObjectContext: NSManagedObjectContext {
</span></span><span style=display:flex><span>   <span style=color:#66d9ef>return</span> (UIApplication.sharedApplication().delegate <span style=color:#66d9ef>as</span>!
</span></span><span style=display:flex><span>           AppDelegate).managedObjectContext
</span></span><span style=display:flex><span>} 
</span></span></code></pre></div><p>There are a number of downsides to this:</p><ol><li>The app delegate is managing the Core Data stack. Classes should only have one responsibility. The app delegate is already responsible for managing application lifecycle. It shouldn’t be managing the Core Data stack as well.</li><li>You are completely dependent on Core Data and using it as your persistence method for your app. What if you decide to switch to Realm or something?</li><li>Any code you write that uses <code>myManagedObjectContext</code> will be dependent on the App Delegate.</li><li>Any tests you write will be dependent on the App Delegate and Core Data and will be hard to test and slow as a result.</li></ol><p>This is basically the lazy developer’s way of doing things. Granted the Xcode templates generate the Core Data code in the app delegate and doing this makes it easy to get the MOC, but Apple’s example code and the Xcode templates are not always the best way to do things. They are frequently the opposite. In this post, let’s just focus on the 2nd issue, that of being dependent on Core Data and using it as your persistence method. Perhaps I will cover the other issues in future posts.</p><p>First off, you’re probably thinking, why would I use anything other than Core Data? What’s the problem with being dependent on Core Data? I hear discussions all the time about people not liking Core Data and wanting to switch to Realm, but this can even be a problem if you never plan on using anything other than Core Data.</p><p>Here’s an example: What if the Core Data API changes? iOS 10 introduces <code>NSPersistentContainer</code>, which now encapsulates the Core Data stack for you. So instead of using an MOC, you might want to use a persistent container instead. So now, everywhere you need to use a persistent container instead of an MOC, you have to change your code.</p><p>So, now you’re thinking, “Ok, smarty pants, how am I supposed to do anything about that? I can’t control what Apple does.” You can’t control what Apple does, but you can protect yourself from any third party code changes you are dependent on. You can accomplish this by putting the dependency behind your own layer of code that you control. Anytime you want to use this third party code, you do so through your own layer. If the third party code changes, you only have to change your layer and how it uses the third party code.</p><p>Let’s look at a concrete example for the situation above. First, I would remove all the code in the app delegate that creates the Core Data stack into a new class. Let’s call it <code>DataStore</code>. For now, you can even add a shared property on it to make it easy to access (<em>this creates its own problems, but we’re just talking about the 2nd issue above for now</em>):</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-swift data-lang=swift><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>DataStore</span> {
</span></span><span style=display:flex><span>   <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>let</span> sharedInstance: DataStore = DataStore()
</span></span><span style=display:flex><span>} 
</span></span></code></pre></div><p>You’ll notice that there’s no mention of Core Data or an MOC. Any code that uses <code>DataStore</code> has no direct dependence on Core Data and has no knowledge of it. <code>DataStore</code> doesn’t let you do anything yet, so let’s add some functionality. Let’s say your app has users and it needs to save them. Here’s a new version of <code>DataStore</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-swift data-lang=swift><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>DataStore</span> {
</span></span><span style=display:flex><span>   <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>let</span> sharedInstance: DataStore = DataStore()
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>   <span style=color:#66d9ef>init</span>() {
</span></span><span style=display:flex><span>       <span style=color:#75715e>// Code to create Core Data stack</span>
</span></span><span style=display:flex><span>   }
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>   <span style=color:#66d9ef>func</span> <span style=color:#a6e22e>addUser</span>(username: String, password: String) -&gt; <span style=color:#66d9ef>throws</span> {
</span></span><span style=display:flex><span>       <span style=color:#75715e>// Code to use Core Data to add a new user to the database.</span>
</span></span><span style=display:flex><span>   }
</span></span><span style=display:flex><span>} 
</span></span></code></pre></div><p>Now, when somewhere in your app you need to create a new user: <code>try DataStore.sharedInstance.addUser("fred@anywhere.com", "12345")</code></p><p>That somewhere in your app doesn’t need to know anything about Core Data. If Core Data changes, it doesn’t care. If you decide to switch to Realm, it doesn’t care. If you decide all you really need is a text file, it doesn’t care. Other than the <code>DataStore</code> class, you have eliminated your dependence on Core Data.</p></div><script async data-uid=d20275c87b src=https://rodschmidt.kit.com/d20275c87b/index.js></script><div class="navigation navigation-single"><a href=https://rodschmidt.com/posts/elixir-robots/ class=navigation-prev><i aria-hidden=true class="fa fa-chevron-left"></i>
<span class=navigation-tittle>Elixir Robots</span></a>
<a href=https://rodschmidt.com/posts/3-ways-to-fix-your-ios-testing-woes/ class=navigation-next><span class=navigation-tittle>3 Ways To Fix Your iOS Testing Woes</span>
<i aria-hidden=true class="fa fa-chevron-right"></i></a></div></article></div><script defer src=https://use.fontawesome.com/releases/v5.11.2/js/all.js integrity=sha384-b3ua1l97aVGAPEIe48b4TC60WUQbQaGi2jqAWM90y0OZXZeyaTCWtBTKtjW2GXG1 crossorigin=anonymous></script></body></html>